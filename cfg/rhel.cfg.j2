keyboard {{ cfg.region.keymap }}
lang {{ cfg.region.locale }}
timezone --utc {{ timezone }}
text
reboot

rhsm --organization={{ cfg.rhel.organization }} --activation-key={{ cfg.rhel.activationKey }} --connect-to-insights

zerombr
clearpart --all --initlabel
autopart --type=lvm
bootloader --location=mbr

rootpw --iscrypted !!
user --name={{ user }} --groups=wheel --gecos="{{ fullname }}"

network --bootproto=dhcp
firewall --enabled --ssh

firstboot --disable
selinux --disabled

skipx

%packages
@^minimal-environment
qemu-guest-agent
-iwl*firmware
%end

services --enabled=rhcd

%post
/bin/mkdir /home/{{ user }}/.ssh
/bin/chmod 0700 /home/{{ user }}/.ssh
/bin/chown {{ user }}:{{ user }} /home/{{ user }}/.ssh
/bin/curl -o /home/{{ user }}/.ssh/authorized_keys {{ cfg.ssh.keysUrl }}
/bin/chmod 0600 /home/{{ user }}/.ssh/authorized_keys
/bin/chown {{ user }}:{{ user }} /home/{{ user }}/.ssh/authorized_keys
/bin/sed -i 's/%wheel\tALL=(ALL)\tALL/%wheel\tALL=(ALL)\tNOPASSWD: ALL/' /etc/sudoers
%end
